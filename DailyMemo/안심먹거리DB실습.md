# [1. 후보군 정하기]

[https://www.notion.so/holdrainnotere47/284951ddbec380b2a2defb034e007938](https://www.notion.so/284951ddbec380b2a2defb034e007938?pvs=21)

[https://www.notion.so/holdrainnotere47/284951ddbec380b2a2defb034e007938?source=copy_link](https://www.notion.so/284951ddbec380b2a2defb034e007938?pvs=21)

<aside>
🌐

**선택 = 배달의 민족**

당근마켓

유튜브

데일리 알고

토스

깃헙

디스코드

찰리와 걷기

[Charlie - 찰리와 걷기 - Google Play 앱](https://play.google.com/store/apps/details?id=com.charlie.walking&hl=ko&pli=1)

</aside>

# [2. 필요한 것 덜어내기]

<aside>
♻️

**[음식 배달 중계 서비스]**

**[적용할 기능]**

가게 정보, 업장 관리, 유저 관리, 게시글(리뷰), 알러지 정보

**[미적용 기능(추후 적용)]**

배달 서비스, 라이더 관리

</aside>

## [주제 : 음식 배달 APP]

## [유저 페르소나]

**유저 타겟:** 5~12살 자녀 및 반려동물이 있는 30~40대 맞벌이 부부.

**유저 니즈:** 안심하고 먹을 수 있는 음식 배달 서비스 플랫폼.

<aside>
⚙

**[자녀가 있는 어머니가 원하는 것]**

- 식재료의 **신선도 및 원산지 확인**
- 음식의 **간 정도(짜지 않음 등) 조절**
- **영양 균형** 및 건강 고려
- 음식의 **분량 및 사이즈 적정성**
</aside>

## [APP 사용 흐름]

시작 → 앱 진입 → 메뉴 고민 → 메뉴 상세 확인(메뉴 종류) → 옵션 확인(알러지 ,음식 간 세기, 재료) → 영양 정보 확인 → 가게 선택 → 예약여부 → 주문 결제 → 배달 수령 및 식사 → 리뷰 남기기 → 끝

<aside>
💡

## **🎯 타겟 유저 프로필**

**이름:** 김하나 (38세)

**가족 구성:** 남편(40세), 초등학교 3학년 아들(9세), 반려견(푸들 1살)

**직업:** IT 회사 마케팅 매니저 (재택 + 출근 병행)

**거주:** 서울 송파구

**소득 수준:** 중상 (월 가계 소득 약 700만원)

**생활 패턴:**

- 오전 8시 출근, 오후 6시 퇴근
- 아이 하교 시간은 오후 3시, 주로 조부모님이 잠시 봐주심
- 주말엔 가족끼리 외식 또는 반려견 산책

---

## **🧩 문제 상황 (Pain Point)**

- 퇴근 후 **요리할 시간**이 거의 없고,
- 대부분 배달앱을 사용하지만 **짜고 기름진 음식** 위주라 아이에게 주기 불안함
- “아이 반찬용으로 건강한 음식”을 시키고 싶지만,
    
    메뉴 설명엔 **영양정보나 원산지 표시가 불충분**
    
- 반려견 전용 간식도 함께 주문하고 싶지만 **한 플랫폼에서 한 번에 주문 불가**

---

## **💡 해결 아이디어 (Needs & Wants)**

김하나는 다음과 같은 기능을 원함:

1. **식재료 신선도 표시**
    
    → 예: “닭고기: 국내산 무항생제”, “야채: 당일 수확” 등 신뢰 가능한 정보 제공
    
2. **간 조절 옵션**
    
    → “저염 / 표준 / 어린이용” 등 선택 가능
    
3. **영양 균형 / 알러지 정보 표시**
    
    → “단백질, 칼슘 풍부”, “우유 성분 없음” 등 표시
    
4. **분량 선택 기능**
    
    → “성인 1인 / 아동 1인 / 가족 2~3인분”
    
5. **반려동물 전용 코너**
    
    → “사람 음식 + 반려견 건강 간식 세트” 같이 묶음 주문 가능
    

---

## **📱 시나리오 예시**

### **1. 퇴근길 지하철에서**

하나는 지하철 안에서 아이 저녁 메뉴를 고민하다가 앱을 켠다.

홈 화면에는 “**아이와 함께 먹는 건강 저녁**” 카테고리가 노출된다.

“닭가슴살 채소볶음(저염/당일조리)”을 선택한다.

하나는 옵션에서 **“저염 + 아동용 1인분”**을 선택한다.

### **2. 상세 페이지**

- “국내산 닭가슴살 (도축일: 오늘)”
- “저염 옵션: 나트륨 30% 감소”
- “영양정보: 단백질 25g, 지방 5g”
- “리뷰: 아이 반찬용으로 좋아요 👍”

신뢰감이 생겨 주문을 확정한다.

### **3. 결제 페이지**

하나는 반려견 간식 코너를 보고 “닭가슴살 트릿(무첨가)”도 함께 담는다.

한 번의 결제로 “**가족+반려견 저녁 세트**” 완성.

배송 예정 시간은 30분 내 — 하나는 도착 알림을 받고 바로 전자레인지에 데운다.

### **4. 식사 후**

앱에서 “오늘 식단 피드백”을 요청한다.

하나는 “짜지 않고 맛있었어요! 아이가 다 먹었어요.”라고 평점을 남긴다.

→ 앱은 다음날 “비슷한 저염 메뉴 추천”을 푸시로 보낸다.

---

## **🌱 기대 효과**

- **사용자 만족도 상승:** 건강/신뢰/편리함 모두 충족
- **재구매율 향상:** 개인 맞춤 추천 기능으로 지속 이용 유도
- **브랜드 이미지 강화:** “아이와 반려동물 모두 안심할 수 있는 음식”

---

</aside>

<aside>
💡

| 요구사항 | 유저 스토리 |
| --- | --- |
| 식재료의 신선도 및 원산지 확인 | **5~12살 아이를 둔 바쁜 워킹맘으로서**, 각 메뉴의 식재료 **신선도(수확일, 보관 조건 등)와 원산지 정보를 쉽게 확인**하고 싶어요. **그래야 가족에게 배달되는 음식의 품질과 안전성을 믿을 수 있거든요.투명성을 중시하는 부모로서**, **원산지(국내산 vs 수입산)와 신선도 등급별로 메뉴를 필터링하거나 검색**할 수 있는 기능을 원해요. **시간이 부족한 와중에도 빠르게 정보에 기반한 선택을 할 수 있게요.** |
| 음식의 간 정도(짜지 않음 등) 조절 | **5~12살 아이를 둔 건강을 생각하는 엄마로서**, 주문 시 **간 정도(저염, 순한 맛 등)를 직접 조절**할 수 있기를 원해요. **아이들 입맛에 맞고 나트륨 과다 섭취 같은 위험을 줄일 수 있으니까요.맞벌이 부모로서**, 앱에 **‘아이 입맛 맞춤’ 간 조절 프리셋 옵션**을 원해요. **커스터마이징 시간을 아끼면서도 너무 짜거나 강하지 않은 식사를 보장받을 수 있으니까요.** |
| 영양 균형 및 건강 고려 | **가족 건강에 집중하는 워킹 부모로서**, **영양 균형(칼로리 분포, 비타민, 알레르기 정보 등)과 건강 이점을 강조한 메뉴 추천**을 원해요. **아이들 성장에 도움이 되는 옵션을 따로 조사할 필요 없이 고를 수 있게요.요리 시간이 부족한 엄마로서**, **아이 연령별 영양 필요량을 기반으로 한 주간 식단 계획 제안 및 추적 도구**를 원해요. **배달이 우리 가족 전체의 웰니스와 영양 결핍 방지에 기여하도록요.** |
| 음식의 분량 및 사이즈 적정성 | **어린 자녀를 위한 분량을 관리하는 부모로서**, 각 메뉴에 **조절 가능한 포션 사이즈(소량/아이용 등)**를 원해요. **낭비를 줄이고 우리 가족 식사량에 딱 맞출 수 있으니까요.아이 또는 반려동물을 둔 바쁜 부부로서**, **연령대별로 확장 가능한 패밀리 번들 옵션(2~4인분 등)**을 원해요. **가구 구성에 정확히 맞춰 배달이 오도록 해 돈과 남는 음식을 줄일 수 있어요.** |
</aside>

<aside>
💡

| **상황** | **행동** | **생각 / 감정** | **기회 (Insight & 개선 포인트)** |
| --- | --- | --- | --- |
| **퇴근길 지하철**아이 저녁 메뉴 고민 중 | 기존 배달앱 열어 메뉴 검색 | “다 짜고 자극적인 음식뿐이네…”“아이 먹이기엔 불안하다.” | ✔️ 건강식 / 어린이 메뉴 전용 카테고리 노출✔️ 첫 진입 시 ‘가족 맞춤 추천’ 제공 |
| **앱 홈 진입** | “아이와 함께 먹는 저염 메뉴” 클릭 | “이건 아이랑 같이 먹어도 되겠다!”신뢰감 + 관심 | ✔️ 홈 화면에 ‘연령대별 / 상황별’ 추천 메뉴 큐레이션✔️ ‘신선도 태그’ 시각화 |
| **메뉴 상세 확인** | 원산지, 영양정보, 간조절 옵션 확인 | “국내산이네. 믿음이 간다.”“저염 옵션도 있네, 좋다!” | ✔️ 식재료 원산지·유통일 표시 강화✔️ ‘영양 균형 점수’ 시각화로 신뢰도 향상 |
| **주문 결정 및 결제** | ‘아동용 1인분 + 반려견 간식’ 함께 주문 | “이렇게 한 번에 주문되니까 편하네.” | ✔️ ‘가족+반려동물 세트 메뉴’ 제안✔️ 결제 전 “오늘의 식단 완성 팁” 추천 |
| **배달 수령 및 식사 후** | 앱 피드백 요청에 별점 작성 | “짜지 않고 맛있었어.”“다음에도 주문해야지.” | ✔️ 후기 기반 맞춤 재추천✔️ 사용자 후기 중 “아이 반응” 강조 리뷰 구분 |
| **다음날 점심 시간** | 푸시 알림: “비슷한 메뉴 추천” | “어제 좋았는데 또 시켜볼까?” | ✔️ 개인 맞춤 재주문 자동화✔️ 구독형 ‘건강식 플랜’ |
|  |  |  |  |
</aside>

---

# [3. 데이터베이스 설계]

## [BDDB **유저 플로우]**

**[부모(일반 사용자)]**

```sql
[앱 실행]
   ↓
[로그인 / 회원가입]
   ↓
[자녀 등록] ──▶ [알러지 등록]
   ↓
[가게 목록 보기]
   ↓
[음식 선택] ──▶ [재료·영양 정보 확인]
   ↓
[알러지 필터링 결과 확인]
   ↓
[주문 옵션 선택 (맵기, 짜기, 당도)]
   ↓
[주문 생성(OrderInfo)]
   ↓
[결제(Payment)]
   ↓
[주문 상태 확인(배달중 / 완료)]
   ↓
[리뷰 작성(StoreReview)]
   ↓
[가게 찜하기(StoreLike)]
   ↓
[종료]
```

- 사장 - 제외
    
    ### [사장]
    
    ```sql
    [로그인 / 회원가입]
       ↓
    [가게 등록(Store)]
       ↓
    [음식 등록(Food)]
       ↓
    [음식 재료 등록(FoodIngredient)]
       ↓
    [주문 알림 수신(OrderInfo)]
       ↓
    [주문 상태 변경 (조리중 → 배달중 → 완료)]
       ↓
    [리뷰 확인 및 응답(StoreReview)]
       ↓
    [가게 통계 / 찜 수 확인(StoreLike)]
       ↓
    [메뉴 수정 / 삭제(Food)]
       ↓
    [종료]
    ```
    
- 관리자 - 제외
    
    ### [**관리자(Admin)]**
    
    ```sql
    [관리자 로그인]
       ↓
    [전체 유저 관리(User)]
       ↓
    [가게 관리(Store)]
       ↓
    [음식 및 알러지 데이터 점검(Food, Allergen)]
       ↓
    [주문/결제 상태 모니터링(OrderInfo, Payment)]
       ↓
    [리뷰 및 평점 통계 확인(StoreReview)]
       ↓
    [데이터 이상 탐지 및 조정]
       ↓
    [시스템 유지보수]
    ```
    

## [BDDB ERD]

### [수정 전]

[BDDB_ERD 설계(수정전).mwb](attachment:9cd4b0db-4628-4c81-8e2d-6574d5ef91fb:BDDB_ERD_설계(수정전).mwb)

![BDDB_ERD 설계(수정전).png](attachment:5aece4ce-75e2-4556-903a-2e64494b05c1:BDDB_ERD_설계(수정전).png)

### [수정 후]

[BDDB_ERD 설계.mwb](attachment:dc15f7a8-ef94-472f-ad12-72101b1a73b8:BDDB_ERD_설계.mwb)

![BDDB_ERD 설계.png](attachment:6a132dff-a6a5-4ea3-862b-53dd9a1600de:BDDB_ERD_설계.png)

## [BDDB 데이터베이스 물리적 설계 스키마]

### [수정 전]

```sql
-- 1. 사용자 테이블
CREATE TABLE User (
  user_id INT AUTO_INCREMENT PRIMARY KEY,
  user_name VARCHAR(50) NOT NULL,
  nickname VARCHAR(30),
  phone VARCHAR(15) UNIQUE NOT NULL,
  birth_date DATE,
  role ENUM('부모', '사장', '관리자') DEFAULT '부모',
  email VARCHAR(100) UNIQUE NOT NULL
);

-- 2. 자녀 테이블
CREATE TABLE Child (
  child_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  nickname VARCHAR(30),
  child_name VARCHAR(50) NOT NULL,
  birth_date DATE,
  gender ENUM('남아', '여아'),
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE
);

-- 3. 알러지 유발 물질
CREATE TABLE Allergen (
  allergen_id INT AUTO_INCREMENT PRIMARY KEY,
  ingredient_name VARCHAR(50) NOT NULL
);

-- 4. 자녀 알러지 매핑
CREATE TABLE ChildAllergy (
  allergy_id INT AUTO_INCREMENT PRIMARY KEY,
  child_id INT NOT NULL,
  allergen_id INT NOT NULL,
  FOREIGN KEY (child_id) REFERENCES Child(child_id) ON DELETE CASCADE,
  FOREIGN KEY (allergen_id) REFERENCES Allergen(allergen_id) ON DELETE CASCADE,
	CONSTRAINT uniq_child_allergen UNIQUE (child_id, allergen_id)
);

-- [5] 가게
CREATE TABLE Store (
  store_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  name VARCHAR(100) NOT NULL,
  address VARCHAR(200),
  phone VARCHAR(15),
  description TEXT,
  photo_url VARCHAR(255),
  likes INT DEFAULT 0,
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE
);

-- 6. 가게 찜
CREATE TABLE StoreLike (
  like_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  store_id INT NOT NULL,
  UNIQUE (user_id, store_id),
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE,
  FOREIGN KEY (store_id) REFERENCES Store(store_id) ON DELETE CASCADE
);

-- 7. 가게 리뷰
CREATE TABLE StoreReview (
  review_id INT AUTO_INCREMENT PRIMARY KEY,
  store_id INT NOT NULL,
  user_id INT NOT NULL,
  order_id INT NOT NULL,
  author_name VARCHAR(50),
  content TEXT,
  photo_url VARCHAR(255),
  rating DECIMAL(2,1) CHECK (rating >= 0 AND rating <= 5),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE (order_id), 
  FOREIGN KEY (store_id) REFERENCES Store(store_id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE,
  FOREIGN KEY (order_id) REFERENCES OrderInfo(order_id) ON DELETE CASCADE 
);
-- 8. 음식
CREATE TABLE Food (
  food_id INT AUTO_INCREMENT PRIMARY KEY,
  store_id INT NOT NULL,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  price DECIMAL(10,2) NOT NULL,
  photo_url VARCHAR(255),
  calories INT,
  protein DECIMAL(5,2),
  vitamin DECIMAL(5,2),
  calcium DECIMAL(5,2),
  is_deleted BOOLEAN DEFAULT FALSE,
  deleted_at DATETIME NULL,
  FOREIGN KEY (store_id) REFERENCES Store(store_id) ON DELETE CASCADE
);

-- 9. 실제 음식 재료
CREATE TABLE FoodIngredient (
  ingredient_id INT AUTO_INCREMENT PRIMARY KEY,
  food_id INT NOT NULL,
  name VARCHAR(100) NOT NULL,
  origin VARCHAR(100),
  organic BOOLEAN DEFAULT FALSE,
  FOREIGN KEY (food_id) REFERENCES Food(food_id) ON DELETE CASCADE
);

-- 10. 음식 - 알러지 관계
CREATE TABLE IngredientAllergen (
  ingredient_id INT NOT NULL,
  allergen_id INT NOT NULL,
  PRIMARY KEY (ingredient_id, allergen_id),
  FOREIGN KEY (ingredient_id) REFERENCES FoodIngredient(ingredient_id) ON DELETE CASCADE,
  FOREIGN KEY (allergen_id) REFERENCES Allergen(allergen_id) ON DELETE CASCADE
);

-- 11. 주문정보
CREATE TABLE OrderInfo (
  order_id INT AUTO_INCREMENT PRIMARY KEY,
  store_id INT NOT NULL,
  user_id INT NOT NULL,
  child_id INT, --추가
  status ENUM('주문대기', '조리중', '배달중', '완료', '취소') DEFAULT '주문대기',
  request_note TEXT,
  reservation_time DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  started_at DATETIME,
  delivered_at DATETIME, 
  FOREIGN KEY (store_id) REFERENCES Store(store_id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE,
  FOREIGN KEY (child_id) REFERENCES Child(child_id) ON DELETE CASCADE --추가
);

-- 12. 주문 음식
CREATE TABLE OrderItem (
  order_item_id INT AUTO_INCREMENT PRIMARY KEY,
  order_id INT NOT NULL,
  food_id INT NOT NULL,
  spicy_level TINYINT CHECK (spicy_level BETWEEN 0 AND 5),
  salty_level TINYINT CHECK (salty_level BETWEEN 0 AND 5),
  sweet_level TINYINT CHECK (sweet_level BETWEEN 0 AND 5),
  final_price DECIMAL(10,2) NOT NULL,
  FOREIGN KEY (order_id) REFERENCES OrderInfo(order_id) ON DELETE CASCADE,
  FOREIGN KEY (food_id) REFERENCES Food(food_id)
);

-- 13. 결제
CREATE TABLE Payment (
  payment_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  order_id INT UNIQUE,
  method ENUM('카드', '현금', '포인트', '간편결제'),
  payment_time DATETIME DEFAULT CURRENT_TIMESTAMP,
  status ENUM('성공', '실패', '취소') DEFAULT '성공',
  amount DECIMAL(10,2) NOT NULL,
  FOREIGN KEY (user_id) REFERENCES User(user_id),
  FOREIGN KEY (order_id) REFERENCES OrderInfo(order_id) ON DELETE CASCADE
);
```

### [수정 후]

```sql
-- 1. 사용자 테이블
CREATE TABLE User (
  user_id INT AUTO_INCREMENT PRIMARY KEY,
  user_name VARCHAR(50) NOT NULL,
  nickname VARCHAR(30),
  phone VARCHAR(15) UNIQUE NOT NULL,
  birth_date DATE,
  role ENUM('부모', '사장', '관리자') DEFAULT '부모',
  email VARCHAR(100) UNIQUE NOT NULL
);

-- 2. 자녀 테이블
CREATE TABLE Child (
  child_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  nickname VARCHAR(30),
  child_name VARCHAR(50) NOT NULL,
  birth_date DATE,
  gender ENUM('남아', '여아'),
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE
);

-- 3. 알러지 유발 물질
CREATE TABLE Allergen (
  allergen_id INT AUTO_INCREMENT PRIMARY KEY,
  ingredient_name VARCHAR(50) NOT NULL
);

-- 4. 자녀 알러지 매핑
CREATE TABLE ChildAllergy (
  allergy_id INT AUTO_INCREMENT PRIMARY KEY,
  child_id INT NOT NULL,
  allergen_id INT NOT NULL,
  FOREIGN KEY (child_id) REFERENCES Child(child_id) ON DELETE CASCADE,
  FOREIGN KEY (allergen_id) REFERENCES Allergen(allergen_id) ON DELETE CASCADE,
	CONSTRAINT uniq_child_allergen UNIQUE (child_id, allergen_id)
);

-- 5. 가게
CREATE TABLE Store (
  store_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  name VARCHAR(100) NOT NULL,
  address VARCHAR(200),
  phone VARCHAR(15),
  description TEXT,
  photo_url VARCHAR(255),
  likes INT DEFAULT 0,
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE
);

-- [6] 가게 찜
CREATE TABLE StoreLike (
  like_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  store_id INT NOT NULL,
  UNIQUE (user_id, store_id),
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE,
  FOREIGN KEY (store_id) REFERENCES Store(store_id) ON DELETE CASCADE
);

-- 7. 음식
CREATE TABLE Food (
  food_id INT AUTO_INCREMENT PRIMARY KEY,
  store_id INT NOT NULL,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  price DECIMAL(10,2) NOT NULL,
  photo_url VARCHAR(255),
  calories INT,
  protein DECIMAL(5,2),
  vitamin DECIMAL(5,2),
  calcium DECIMAL(5,2),
  -- 소프트 딜리트(음식을 삭제해도 주문한 사람들은 해당 음식을 주문했었다는 것을 알 수 있게)
  is_deleted BOOLEAN DEFAULT FALSE,
  deleted_at DATETIME NULL,
  FOREIGN KEY (store_id) REFERENCES Store(store_id) ON DELETE CASCADE
);

-- 8. 실제 음식 재료
CREATE TABLE FoodIngredient (
  ingredient_id INT AUTO_INCREMENT PRIMARY KEY,
  food_id INT NOT NULL,
  name VARCHAR(100) NOT NULL,
  origin VARCHAR(100),
  organic BOOLEAN DEFAULT FALSE,
  FOREIGN KEY (food_id) REFERENCES Food(food_id) ON DELETE CASCADE
);

-- 9. 음식 - 알러지 관계
CREATE TABLE IngredientAllergen (
  ingredient_id INT NOT NULL,
  allergen_id INT NOT NULL,
  PRIMARY KEY (ingredient_id, allergen_id),
  FOREIGN KEY (ingredient_id) REFERENCES FoodIngredient(ingredient_id) ON DELETE CASCADE,
  FOREIGN KEY (allergen_id) REFERENCES Allergen(allergen_id) ON DELETE CASCADE
);

-- 10. 주문정보
CREATE TABLE OrderInfo (
  order_id INT AUTO_INCREMENT PRIMARY KEY,
  store_id INT NOT NULL,
  user_id INT NOT NULL,
  child_id INT,
  status ENUM('주문대기', '조리중', '배달중', '완료', '취소') DEFAULT '주문대기',
  request_note TEXT,
  reservation_time DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  started_at DATETIME,
  delivered_at DATETIME, 
  FOREIGN KEY (store_id) REFERENCES Store(store_id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE,
  FOREIGN KEY (child_id) REFERENCES Child(child_id) ON DELETE CASCADE
);

-- 11. 주문 음식
CREATE TABLE OrderItem (
  order_item_id INT AUTO_INCREMENT PRIMARY KEY,
  order_id INT NOT NULL,
  food_id INT NOT NULL,
  spicy_level TINYINT CHECK (spicy_level BETWEEN 0 AND 5),
  salty_level TINYINT CHECK (salty_level BETWEEN 0 AND 5),
  sweet_level TINYINT CHECK (sweet_level BETWEEN 0 AND 5),
  final_price DECIMAL(10,2) NOT NULL,
  FOREIGN KEY (order_id) REFERENCES OrderInfo(order_id) ON DELETE CASCADE,
  FOREIGN KEY (food_id) REFERENCES Food(food_id)
);

-- 12. 결제
CREATE TABLE Payment (
  payment_id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  order_id INT UNIQUE,
  method ENUM('카드', '현금', '포인트', '간편결제'),
  payment_time DATETIME DEFAULT CURRENT_TIMESTAMP,
  status ENUM('성공', '실패', '취소') DEFAULT '성공',
  amount DECIMAL(10,2) NOT NULL,
  FOREIGN KEY (user_id) REFERENCES User(user_id),
  FOREIGN KEY (order_id) REFERENCES OrderInfo(order_id) ON DELETE CASCADE
);

-- 13. 가게 리뷰
CREATE TABLE StoreReview (
  review_id INT AUTO_INCREMENT PRIMARY KEY,
  store_id INT NOT NULL,
  user_id INT NOT NULL,
  order_id INT NOT NULL,
  author_name VARCHAR(50),
  content TEXT,
  photo_url VARCHAR(255),
  rating DECIMAL(2,1) CHECK (rating >= 0 AND rating <= 5),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE (order_id), 
  FOREIGN KEY (store_id) REFERENCES Store(store_id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES User(user_id) ON DELETE CASCADE,
  FOREIGN KEY (order_id) REFERENCES OrderInfo(order_id) ON DELETE CASCADE 
);
```

## [스키마 생성 순서]

<aside>
📖

1 User

2 Child — (User 참조)

3 Allergen

4 ChildAllergy — (Child, Allergen 참조)

5 Store — (User 참조)

6 Food — (Store 참조)

7 FoodIngredient — (Food 참조)

8 IngredientAllergen — (FoodIngredient, Allergen 참조)

9 OrderInfo — (Store, User, Child 참조)

10 OrderItem — (OrderInfo, Food 참조)

11 Payment — (User, OrderInfo 참조)

12  StoreLike — (User, Store 참조)

13 StoreReview — (Store, User, OrderInfo 참조)

</aside>

## [BDDB 스키마 관계 &제약]

```sql
[User / Child / ChildAllergy / Allergen]

1. User
	역할: 부모, 사장, 관리자 등 모든 회원의 기본 정보 저장.
	핵심 컬럼
	•	role: ENUM으로 역할 구분 (‘부모’, ‘사장’, ‘관리자’)
	•	phone, email: 유니크 제약조건으로 중복가입 방지.
	관계
	•	1:N → Child (부모당 여러 자녀)
	•	1:N → Store (사장당 여러 가게)
	•	1:N → OrderInfo, Payment, StoreReview

2. Child
	역할: 부모 계정에 속한 자녀 정보.
	핵심 컬럼: gender, birth_date, nickname
	관계
	•	N:1 → User
	•	1:N → ChildAllergy
	•	1:N → OrderInfo (주문 시 어떤 자녀를 위한 주문인지 표시)

3. Allergen
	역할: 조개류, 난류, 우유 등 알러지 유발 물질 목록.
	관계
	•	N:M → FoodIngredient (재료에 어떤 알러젠이 포함되어 있는가. FoodIngredient로 풀어냄)
	•	N:M → Child (어떤 자녀가 어떤 알러지 물질에 반응하는가. ChildAllergy로 풀어냄)

4. ChildAllergy
	역할: 자녀별 알러지 물질 매핑 테이블.
	관계
	•	N:1 → Child
	•	N:1 → Allergen
	제약
	•	(child_id, allergen_id)에 UNIQUE 제약 → 중복 방지.

⸻

[Store / Food / FoodIngredient / IngredientAllergen]

5. Store
	역할: 가게 정보 (사장 계정이 소유함).
	관계
	•	N:1 → User (사장)
	•	1:N → Food
	•	1:N → OrderInfo
	•	1:N → StoreReview
	•	N:M → User (부모가 찜을 한 내용. StoreLike로 풀어냄)

6. StoreLike
	역할: 유저가 찜한 가게 기록.
	관계
	•	N:1 → User
	•	N:1 → Store
	제약
	•	UNIQUE(user_id, store_id)로 한 유저가 같은 가게를 중복 찜 불가.

7. StoreReview
	역할: 주문 후 작성되는 리뷰.
	관계
	•	N:1 → Store
	•	N:1 → User
	•	1:1 → OrderInfo (한 주문당 하나의 리뷰만 작성 가능)
	제약
	•	UNIQUE(order_id) → 동일 주문 중복 리뷰 방지.

8. Food
	역할: 메뉴 정보.
	관계
	•	N:1 → Store
	•	1:N → FoodIngredient
	•	1:N → OrderItem
	특징
	•	is_deleted와 deleted_at으로 소프트 딜리트 구현 (삭제 이력 유지 가능).

9. FoodIngredient
	역할: 음식별 실제 재료 목록.
	관계
	•	N:1 → Food
	•	N:M → Allergen (IngredientAllergen로 풀어냄)

10. IngredientAllergen
	역할: 특정 재료가 어떤 알러지 유발 물질을 포함하는지 명시.
	관계
	•	N:1 → FoodIngredient
	•	N:1 → Allergen
	기능
	•	알러지 필터 기능 구현 시 핵심 테이블.

⸻

[OrderInfo / OrderItem / Payment]

11. OrderInfo
	역할: 주문의 본체 정보 (가게, 유저, 자녀, 요청사항 등).
	관계
	•	N:1 → User
	•	N:1 → Store
	•	N:1 → Child
	•	1:N → OrderItem
	•	1:1 → Payment
	•	1:1 → StoreReview
	특징
	•	status ENUM: 주문 상태 흐름 관리 (‘주문대기’ → ‘조리중’ → ‘배달중’ → ‘완료’)
	•	reservation_time: 예약 주문 지원.
	•	started_at, delivered_at: 실제 조리 및 배달 시각 관리.

12. OrderItem
	역할: 주문된 개별 음식 항목.
	관계
	•	N:1 → OrderInfo
	•	N:1 → Food
	기능
	음식의 맞춤 옵션 저장 (맵기, 짜기, 당도).
	•	final_price: 개별 항목의 최종가 계산용.

13. Payment
	역할: 주문 결제 내역.
	관계
	•	1:1 → OrderInfo (한 주문에 한 결제)
	•	N:1 → User
	제약
	•	order_id UNIQUE → 결제는 주문당 하나만 가능.
	•[ENUM 필드]
	•	method: 카드, 현금, 간편결제 등.(pay_type, payment_type등 네이밍 수정 필요)
	•	status: 성공, 실패, 취소 상태.
```

## [BDDB 더미데이터]

```sql
-- [1] User
INSERT INTO User (user_name, nickname, phone, birth_date, role, email) VALUES
('김현지', '현지맘', '010-1000-0001', '1990-05-14', '부모', 'hyunji1@example.com'),
('이수민', '수민맘', '010-1000-0002', '1988-02-20', '부모', 'sumimom@example.com'),
('박지훈', '훈사장', '010-1000-0003', '1985-08-09', '사장', 'hunboss@example.com'),
('정가영', '가영사장', '010-1000-0004', '1983-12-11', '사장', 'gayoungstore@example.com'),
('최영수', '관리자', '010-1000-0005', '1979-06-17', '관리자', 'admin1@example.com'),
('김은지', '은지맘', '010-1000-0006', '1991-03-15', '부모', 'eunjimom@example.com'),
('조민서', '민서맘', '010-1000-0007', '1989-07-23', '부모', 'minseomom@example.com'),
('한지민', '지민맘', '010-1000-0008', '1992-01-19', '부모', 'jiminmom@example.com'),
('이하늘', '하늘사장', '010-1000-0009', '1984-11-30', '사장', 'haneulstore@example.com'),
('장윤호', '윤호사장', '010-1000-0010', '1986-04-10', '사장', 'yunhostore@example.com'),
('오서준', '서준사장', '010-1000-0011', '1987-09-13', '사장', 'seojunshop@example.com'),
('배유나', '유나맘', '010-1000-0012', '1993-02-04', '부모', 'yunamom@example.com'),
('남도현', '도현사장', '010-1000-0013', '1982-03-21', '사장', 'dohyunshop@example.com'),
('이하은', '하은맘', '010-1000-0014', '1990-09-01', '부모', 'haeunmom@example.com'),
('서민지', '민지맘', '010-1000-0015', '1991-07-07', '부모', 'minjimom@example.com'),
('홍수아', '수아맘', '010-1000-0016', '1988-05-22', '부모', 'sua@example.com'),
('정다빈', '다빈맘', '010-1000-0017', '1994-08-28', '부모', 'dabinmom@example.com'),
('문지호', '지호사장', '010-1000-0018', '1981-10-12', '사장', 'jiho@example.com'),
('유지혜', '지혜관리자', '010-1000-0019', '1980-03-08', '관리자', 'jihyeadmin@example.com'),
('박하린', '하린맘', '010-1000-0020', '1992-12-05', '부모', 'harinmom@example.com');

-- [2] Child
INSERT INTO Child (user_id, nickname, child_name, birth_date, gender) VALUES
(1, '민지', '김민지', '2015-06-10', '여아'),
(1, '지안', '김지안', '2013-09-21', '여아'),
(2, '도윤', '이도윤', '2014-11-02', '남아'),
(6, '지우', '김지우', '2016-05-12', '여아'),
(7, '하준', '조하준', '2015-02-28', '남아'),
(8, '서연', '한서연', '2013-07-19', '여아'),
(12, '유진', '배유진', '2017-03-11', '여아'),
(14, '하율', '이하율', '2016-08-24', '여아'),
(15, '민호', '서민호', '2014-01-29', '남아'),
(16, '수빈', '홍수빈', '2015-10-05', '여아'),
(17, '다현', '정다현', '2017-09-17', '여아'),
(20, '하린', '박하린', '2018-12-05', '여아'),
(6, '은호', '김은호', '2016-11-30', '남아'),
(7, '주원', '조주원', '2015-12-12', '남아'),
(8, '지후', '한지후', '2017-02-14', '남아'),
(12, '유나', '배유나', '2018-07-22', '여아'),
(14, '하진', '이하진', '2014-09-13', '남아'),
(15, '지온', '서지온', '2013-03-20', '남아'),
(16, '수아', '홍수아', '2016-06-01', '여아'),
(17, '다율', '정다율', '2018-08-30', '여아');

-- [3] Allergen
INSERT INTO Allergen (ingredient_name) VALUES
('난류'),('우유'),('대두'),('밀'),('땅콩'),
('새우'),('게'),('조개류'),('복숭아'),('토마토'),
('닭고기'),('쇠고기'),('돼지고기'),('오징어'),('고등어'),
('메밀'),('호두'),('잣'),('아황산'),('참깨');

-- [4] ChildAllergy
INSERT INTO ChildAllergy (child_id, allergen_id) VALUES
(1, 2), (2, 4), (3, 5), (4, 1), (5, 3),
(6, 7), (7, 8), (8, 10), (9, 9), (10, 12),
(11, 13), (12, 15), (13, 16), (14, 18), (15, 6),
(16, 11), (17, 17), (18, 19), (19, 20), (20, 14);
-- [5] Store
INSERT INTO Store (user_id, name, address, phone, description, photo_url, likes) VALUES
(3, '훈이네 반찬가게', '서울특별시 강남구 테헤란로 123', '02-111-1111', '매일 신선한 반찬을 직접 만듭니다.', 'store1.jpg', 32),
(4, '가영이네 죽집', '서울특별시 송파구 백제고분로 77', '02-222-2222', '영양 가득한 죽 전문점입니다.', 'store2.jpg', 54),
(9, '하늘이네 도시락', '서울특별시 서초구 방배로 45', '02-333-3333', '아이들을 위한 건강 도시락 전문점.', 'store3.jpg', 40),
(10, '윤호네 건강반찬', '서울특별시 마포구 월드컵북로 22', '02-444-4444', '간이 세지 않은 건강 반찬 위주로 구성됩니다.', 'store4.jpg', 29),
(11, '서준이 반찬가게', '서울특별시 강서구 마곡중앙로 12', '02-555-5555', '짜지 않고 달지 않은 건강 반찬 전문.', 'store5.jpg', 65),
(13, '도현이네 밀키트', '서울특별시 용산구 한강대로 90', '02-666-6666', '밀키트로 간편하게 즐기는 건강식.', 'store6.jpg', 21),
(18, '지호푸드', '서울특별시 종로구 종로 24', '02-777-7777', '영양 맞춤 반찬 정기배송 전문점.', 'store7.jpg', 37),
(9, '하늘도시락 2호점', '서울특별시 서초구 효령로 35', '02-333-8888', '프리미엄 어린이 도시락.', 'store8.jpg', 11),
(10, '윤호의 간편식', '서울특별시 마포구 망원로 50', '02-444-8888', '아이도 어른도 좋아하는 간편 반찬.', 'store9.jpg', 42),
(11, '서준이네 이유식', '서울특별시 강서구 양천로 19', '02-555-8888', '이유식부터 성인식까지, 가족식 맞춤.', 'store10.jpg', 58),
(3, '훈이 반찬연구소', '서울특별시 강남구 논현로 71', '02-111-2222', '짜지 않은 밥도둑 반찬 전문.', 'store11.jpg', 24),
(4, '가영 죽 카페', '서울특별시 송파구 올림픽로 45', '02-222-3333', '커피와 함께 먹는 영양죽 카페.', 'store12.jpg', 35),
(9, '하늘 반찬연구소', '서울특별시 서초구 강남대로 99', '02-333-4444', '아이 간 맞춤식 반찬 실험실.', 'store13.jpg', 19),
(10, '윤호네 장조림전문', '서울특별시 마포구 독막로 12', '02-444-5555', '달지 않고 부드러운 장조림 전문점.', 'store14.jpg', 46),
(11, '서준이 도시락', '서울특별시 강서구 공항대로 101', '02-555-6666', '학교 도시락 맞춤형 반찬.', 'store15.jpg', 50),
(13, '도현푸드랩', '서울특별시 용산구 후암로 80', '02-666-7777', '신선 재료만 사용하는 반조리 밀키트 전문.', 'store16.jpg', 22),
(18, '지호 도시락', '서울특별시 종로구 세종대로 22', '02-777-9999', '영양 도시락 맞춤 주문 가능.', 'store17.jpg', 17),
(9, '하늘네 반찬편집샵', '서울특별시 서초구 사평대로 55', '02-333-9999', '여러 반찬 브랜드를 한곳에서.', 'store18.jpg', 12),
(10, '윤호플러스', '서울특별시 마포구 상암로 33', '02-444-9999', '패밀리 건강식 전문.', 'store19.jpg', 40),
(13, '도현반찬연구소', '서울특별시 용산구 두텁바위로 60', '02-666-9999', '직접 만든 반찬과 소스.', 'store20.jpg', 31);

-- [7] Food
INSERT INTO Food (store_id, name, description, price, photo_url, calories, protein, vitamin, calcium) VALUES
(1, '소고기 미역죽', '소화가 잘 되는 영양죽', 8900, 'food1.jpg', 350, 12.5, 3.2, 2.1),
(2, '전복죽', '신선한 전복과 쌀로 만든 고급죽', 12900, 'food2.jpg', 420, 18.0, 2.8, 3.4),
(3, '닭가슴살 샐러드', '단백질 가득한 샐러드', 8500, 'food3.jpg', 280, 25.0, 5.1, 2.5),
(4, '멸치볶음', '아이도 좋아하는 짭짤한 멸치볶음', 4900, 'food4.jpg', 150, 8.0, 1.0, 6.3),
(5, '달걀말이', '부드럽고 고소한 달걀말이', 5900, 'food5.jpg', 220, 11.0, 2.0, 3.1),
(6, '돼지고기 장조림', '간장향 가득한 장조림', 7900, 'food6.jpg', 320, 15.0, 2.2, 4.5),
(7, '시금치나물', '싱싱한 시금치로 만든 나물', 3500, 'food7.jpg', 100, 4.0, 3.6, 3.3),
(8, '소불고기 도시락', '달콤짭짤한 소불고기 도시락', 9500, 'food8.jpg', 520, 22.5, 3.1, 2.9),
(9, '두부조림', '짭조름하고 담백한 두부조림', 5800, 'food9.jpg', 270, 10.0, 2.2, 5.0),
(10, '연어구이', '오븐에 구운 연어', 11900, 'food10.jpg', 430, 27.0, 4.2, 2.7),
(11, '잡곡밥 도시락', '영양 가득 잡곡밥 세트', 9700, 'food11.jpg', 390, 10.5, 4.1, 4.4),
(12, '닭죽', '국내산 닭으로 끓인 영양죽', 8900, 'food12.jpg', 360, 20.0, 3.0, 2.6),
(13, '채소비빔밥', '채소로만 구성된 건강 비빔밥', 9200, 'food13.jpg', 410, 9.0, 5.5, 3.2),
(14, '버섯불고기', '버섯과 함께 즐기는 불고기', 10200, 'food14.jpg', 480, 23.0, 4.0, 3.7),
(15, '고등어조림', '비린내 없는 담백한 고등어조림', 8700, 'food15.jpg', 380, 20.0, 2.0, 6.0),
(16, '청경채볶음', '간이 약한 아기반찬용 청경채볶음', 4200, 'food16.jpg', 180, 5.0, 3.4, 4.8),
(17, '쇠고기 장조림', '국내산 소고기만 사용한 장조림', 9900, 'food17.jpg', 330, 18.0, 2.8, 5.2),
(18, '연두부 샐러드', '연두부와 채소가 어우러진 샐러드', 7500, 'food18.jpg', 240, 12.0, 5.0, 3.5),
(19, '시래기된장국', '구수하고 짠맛이 적은 된장국', 5900, 'food19.jpg', 200, 8.0, 3.2, 4.0),
(20, '소고기무국', '맑고 깔끔한 국물요리', 7200, 'food20.jpg', 310, 16.0, 2.0, 5.5);

-- [9] FoodIngredient
INSERT INTO FoodIngredient (food_id, name, origin, organic) VALUES
(1, '소고기', '국내산', TRUE),
(1, '미역', '완도산', TRUE),
(2, '전복', '완도산', TRUE),
(3, '닭가슴살', '국내산', TRUE),
(4, '멸치', '통영산', TRUE),
(5, '달걀', '국내산', FALSE),
(6, '돼지고기', '국내산', TRUE),
(7, '시금치', '충남 예산', TRUE),
(8, '소고기', '국내산', TRUE),
(9, '두부', '국내산', TRUE),
(10, '연어', '노르웨이산', FALSE),
(11, '쌀', '철원산', TRUE),
(12, '닭고기', '국내산', TRUE),
(13, '각종 채소', '국내산', TRUE),
(14, '버섯', '강원도 홍천', TRUE),
(15, '고등어', '제주산', FALSE),
(16, '청경채', '경기도 여주', TRUE),
(17, '쇠고기', '호주산', FALSE),
(18, '연두부', '국내산', TRUE),
(19, '시래기', '충북 괴산', TRUE),
(20, '무', '전남 해남', TRUE);
-- [10] IngredientAllergen
INSERT INTO IngredientAllergen (ingredient_id, allergen_id) VALUES
(1, 12), (2, 8), (3, 7), (4, 15), (5, 1),
(6, 13), (7, 4), (8, 12), (9, 3), (10, 15),
(11, 4), (12, 11), (13, 3), (14, 12), (15, 15),
(16, 4), (17, 12), (18, 3), (19, 4), (20, 2);

```

```sql
-- [11] OrderInfo
INSERT INTO OrderInfo (store_id, user_id, child_id, status, request_note, reservation_time, started_at, delivered_at) VALUES
(1, 1, 1, '완료', '짠맛 약하게 해주세요', '2025-10-29 12:00:00', '2025-10-29 12:10:00', '2025-10-29 12:40:00'),
(2, 1, 2, '배달중', '죽은 따뜻하게 부탁드려요', '2025-10-30 18:00:00', '2025-10-30 18:05:00', NULL),
(3, 2, 3, '조리중', '드레싱은 따로 주세요', '2025-10-30 19:00:00', '2025-10-30 19:05:00', NULL),
(4, 6, 4, '완료', '짜지 않게 부탁드려요', '2025-10-25 11:00:00', '2025-10-25 11:10:00', '2025-10-25 11:40:00'),
(5, 7, 5, '완료', '양 많게 부탁드려요', '2025-10-27 13:00:00', '2025-10-27 13:10:00', '2025-10-27 13:50:00'),
(6, 8, 6, '취소', '급하게 주문 취소합니다', '2025-10-27 09:00:00', NULL, NULL),
(7, 12, 7, '완료', '짠맛 최소로', '2025-10-28 12:00:00', '2025-10-28 12:05:00', '2025-10-28 12:35:00'),
(8, 14, 8, '완료', '밥은 부드럽게', '2025-10-28 14:00:00', '2025-10-28 14:10:00', '2025-10-28 14:50:00'),
(9, 15, 9, '완료', '아이 먹기 좋은 간', '2025-10-29 11:00:00', '2025-10-29 11:15:00', '2025-10-29 11:45:00'),
(10, 16, 10, '완료', '생선 뼈 제거해주세요', '2025-10-29 17:00:00', '2025-10-29 17:05:00', '2025-10-29 17:40:00'),
(11, 17, 11, '완료', '도시락 나눠 담아주세요', '2025-10-29 12:00:00', '2025-10-29 12:10:00', '2025-10-29 12:40:00'),
(12, 20, 12, '배달중', '뜨겁게 유지해주세요', '2025-10-30 18:00:00', '2025-10-30 18:05:00', NULL),
(13, 6, 13, '완료', '간 조금 약하게', '2025-10-26 12:00:00', '2025-10-26 12:05:00', '2025-10-26 12:40:00'),
(14, 7, 14, '완료', '버섯 추가해주세요', '2025-10-26 19:00:00', '2025-10-26 19:10:00', '2025-10-26 19:45:00'),
(15, 8, 15, '완료', '짠맛 줄여주세요', '2025-10-26 20:00:00', '2025-10-26 20:05:00', '2025-10-26 20:40:00'),
(16, 12, 16, '완료', '아이용으로 잘게 썰어주세요', '2025-10-27 17:00:00', '2025-10-27 17:05:00', '2025-10-27 17:50:00'),
(17, 14, 17, '완료', '밥은 따뜻하게', '2025-10-27 18:00:00', '2025-10-27 18:05:00', '2025-10-27 18:35:00'),
(18, 15, 18, '완료', '샐러드 드레싱 적게', '2025-10-27 19:00:00', '2025-10-27 19:05:00', '2025-10-27 19:40:00'),
(19, 16, 19, '완료', '국은 식지 않게', '2025-10-27 20:00:00', '2025-10-27 20:05:00', '2025-10-27 20:40:00'),
(20, 17, 20, '완료', '아이용 숟가락 동봉', '2025-10-28 09:00:00', '2025-10-28 09:05:00', '2025-10-28 09:40:00');

-- [12] OrderItem
INSERT INTO OrderItem (order_id, food_id, spicy_level, salty_level, sweet_level, final_price) VALUES
(1, 1, 0, 2, 3, 8900),
(2, 2, 0, 2, 2, 12900),
(3, 3, 1, 1, 2, 8500),
(4, 4, 0, 3, 2, 4900),
(5, 5, 0, 2, 3, 5900),
(6, 6, 0, 2, 3, 7900),
(7, 7, 0, 1, 2, 3500),
(8, 8, 1, 2, 3, 9500),
(9, 9, 0, 2, 3, 5800),
(10, 10, 0, 2, 2, 11900),
(11, 11, 0, 1, 2, 9700),
(12, 12, 0, 2, 3, 8900),
(13, 13, 0, 2, 2, 9200),
(14, 14, 0, 2, 3, 10200),
(15, 15, 0, 2, 2, 8700),
(16, 16, 0, 1, 2, 4200),
(17, 17, 0, 2, 3, 9900),
(18, 18, 0, 1, 3, 7500),
(19, 19, 0, 1, 2, 5900),
(20, 20, 0, 2, 3, 7200);

-- [13] Payment
INSERT INTO Payment (user_id, order_id, method, status, amount) VALUES
(1, 1, '카드', '성공', 8900),
(1, 2, '카드', '성공', 12900),
(2, 3, '현금', '성공', 8500),
(6, 4, '카드', '성공', 4900),
(7, 5, '간편결제', '성공', 5900),
(8, 6, '카드', '취소', 7900),
(12, 7, '카드', '성공', 3500),
(14, 8, '현금', '성공', 9500),
(15, 9, '간편결제', '성공', 5800),
(16, 10, '카드', '성공', 11900),
(17, 11, '카드', '성공', 9700),
(20, 12, '카드', '성공', 8900),
(6, 13, '카드', '성공', 9200),
(7, 14, '현금', '성공', 10200),
(8, 15, '카드', '성공', 8700),
(12, 16, '간편결제', '성공', 4200),
(14, 17, '현금', '성공', 9900),
(15, 18, '카드', '성공', 7500),
(16, 19, '카드', '성공', 5900),
(17, 20, '현금', '성공', 7200);

-- [14] StoreReview
INSERT INTO StoreReview (store_id, user_id, order_id, author_name, content, photo_url, rating, created_at) VALUES
(1, 1, 1, '김현지', '소고기 미역죽이 정말 부드럽고 맛있어요. 아이가 잘 먹었어요!', 'review1.jpg', 4.8, '2025-10-29 13:00:00'),
(2, 1, 2, '김현지', '전복죽이 따뜻하고 신선했어요. 양도 충분했어요.', 'review2.jpg', 4.9, '2025-10-30 19:00:00'),
(3, 2, 3, '이수민', '닭가슴살 샐러드가 신선하고 드레싱도 맛있어요.', 'review3.jpg', 4.7, '2025-10-30 19:30:00'),
(4, 6, 4, '김은지', '멸치볶음이 짜지 않고 딱 좋아요. 밥도둑!', 'review4.jpg', 4.6, '2025-10-25 12:00:00'),
(5, 7, 5, '조민서', '달걀말이가 너무 예쁘게 말려 있고 간이 적당해요.', 'review5.jpg', 4.9, '2025-10-27 14:00:00'),
(7, 12, 7, '배유나', '시금치나물이 신선하고 아기 반찬으로 좋아요.', 'review6.jpg', 4.7, '2025-10-28 13:00:00'),
(8, 14, 8, '이하은', '소불고기 도시락의 밸런스가 좋아요. 양도 넉넉.', 'review7.jpg', 4.8, '2025-10-28 15:00:00'),
(9, 15, 9, '서민지', '두부조림 간이 세지 않아 아이가 잘 먹었어요.', 'review8.jpg', 4.9, '2025-10-29 12:00:00'),
(10, 16, 10, '홍수아', '연어구이가 촉촉하고 비린내가 없어요. 최고!', 'review9.jpg', 5.0, '2025-10-29 18:00:00'),
(11, 17, 11, '정다빈', '잡곡밥 도시락의 반찬 구성이 훌륭해요.', 'review10.jpg', 4.8, '2025-10-29 13:00:00'),
(13, 6, 13, '김은지', '채소비빔밥이 신선하고 간이 약해서 좋았어요.', 'review11.jpg', 4.6, '2025-10-26 13:00:00'),
(14, 7, 14, '조민서', '버섯불고기 맛있어요. 재주문 의사 있어요.', 'review12.jpg', 4.9, '2025-10-26 20:00:00'),
(15, 8, 15, '한지민', '고등어조림이 비리지 않고 부드러워요.', 'review13.jpg', 4.8, '2025-10-26 21:00:00'),
(16, 12, 16, '배유나', '청경채볶음이 너무 맛있고 건강해요.', 'review14.jpg', 4.7, '2025-10-27 18:00:00'),
(17, 14, 17, '이하은', '쇠고기 장조림이 간이 딱이에요. 짜지 않아요.', 'review15.jpg', 4.8, '2025-10-27 19:00:00'),
(18, 15, 18, '서민지', '연두부 샐러드가 담백하고 좋아요.', 'review16.jpg', 4.9, '2025-10-27 20:00:00'),
(19, 16, 19, '홍수아', '시래기된장국 구수하고 너무 좋아요.', 'review17.jpg', 4.8, '2025-10-27 21:00:00'),
(20, 17, 20, '정다빈', '소고기무국이 진하고 깔끔해요.', 'review18.jpg', 4.9, '2025-10-28 10:00:00'),
(6, 8, 6, '한지민', '주문 취소했는데 환불 빠르게 처리됐어요.', 'review19.jpg', 4.5, '2025-10-27 09:30:00'),
(12, 20, 12, '박하린', '닭죽이 따뜻하고 부드러워서 아이가 잘 먹었어요.', 'review20.jpg', 4.9, '2025-10-30 19:00:00');
```

## [BDDB 서비스 로직에 필요한 쿼리문]

### [회원가입 및 자녀 정보 등록]

```sql
-- 김현지라는 35세 여성 자식(10살 남아 민수- 토마토 알러지가 있음)
-- 김현지 회원가입

INSERT INTO User (user_name, nickname, phone, birth_date, role, email)
VALUES ('김현지', '현지맘', '010-4444-5521', '1990-05-14', '부모', 'hyunji@example.com');

-- 김현지가 본인의 자식을 등록하려고 함.
INSERT INTO Child (user_id, nickname, child_name, birth_date, gender)
	VALUES(135,'민수', '김민수', '2015-10-29', '남아');

-- 김현지가 본인 자식의 알러지 정보를 등록

INSERT INTO ChildAllergy (child_id, allergen_id)
VALUES (1, 1), (1, 2);

```

### [가게 평점 확인]

```sql
SELECT S.name AS store_name, AVG(R.rating) AS avg_rating
FROM Store S JOIN StoreReview R
ON S.store_id = R.store_id
GROUP BY S.name;
```

### [내가 찜한 가게 확인]

```sql
SELECT U.user_name, S.name AS liked_store
FROM StoreLike SL
JOIN User U ON SL.user_id = U.user_id
JOIN Store S ON SL.store_id = S.store_id;
```

### [음식 검색]

```sql
-- 토마토가 들어가지 않은 음식 조회
SELECT
  S.name AS store_name,
  F.name AS food_name,
  GROUP_CONCAT(FI.name SEPARATOR ', ') AS ingredients
FROM Store S
JOIN Food F ON S.store_id = F.store_id
JOIN FoodIngredient FI ON F.food_id = FI.food_id
GROUP BY S.name, F.name;

-- 특정 id를 지닌 자식이 알러지가 없는 음식들을 조회
SELECT f.* FROM Food f
WHERE NOT EXISTS (
	SELECT food_id 
	FROM FoodIngredient fi	
	JOIN ChildAllergy AS ca
	 	ON fi.allergen_id = ca.allergen_id	
	WHERE child_id = 2		
		AND fi.food_id = f.food_id  
);
```

### [음식 선택: 가영이네 소고기 미역죽을 선택]

```sql
SELECT 
  S.name AS store_name,
  F.name AS food_name,
  F.price,
  F.photo_url,
  F.description
FROM Store S JOIN Food F
	ON S.store_id = F.store_id
WHERE S.name = '가영이네'
  AND F.name = '소고기 미역죽';
```

### [서비스 - 음식 주문 (맵기 0, 짠맛 2, 단맛 3, 가격 자동 참조)]

```sql
INSERT INTO OrderInfo (store_id, user_id)VALUES (45, 135);

INSERT INTO OrderItem (
  order_id,
  food_id,
  spicy_level,
  salty_level,
  sweet_level,
  final_price
)
VALUES (
  LAST_INSERT_ID(),  -- 방금 생성된 주문 ID
  (SELECT food_id FROM Food WHERE name = '소고기 미역죽' AND store_id = (SELECT store_id FROM Store WHERE name = '가영이네')),
  0,
  2,
  3,
  (SELECT price FROM Food WHERE name = '소고기 미역죽' AND store_id = (SELECT store_id FROM Store WHERE name = '가영이네'))
);
```

### [결제]

```sql
INSERT INTO Payment (
  user_id,
  order_id,
  method,
  amount,
  payment_time,
  status
)
VALUES (
  (SELECT user_id FROM User WHERE user_name = '김현지'),     -- 결제자
  (SELECT order_id FROM OrderInfo 
   WHERE user_id = (SELECT user_id FROM User WHERE user_name = '김현지') 
     AND store_id = (SELECT store_id FROM Store WHERE name = '가영이네')
   ORDER BY created_at DESC LIMIT 1),                        -- 최근 주문
  '카드',                                                   -- 결제 수단
  10500.00,                                              
  NOW(),                                                    -- 결제시각
  '성공'                                                    -- 결제 상태
);
```

### [상태 확인 (조리 → 배달 → 완료)]

```sql
-- 가게에서 주문 접수
UPDATE OrderInfo 
SET status = '조리중', started_at = NOW()
WHERE order_id = (SELECT MAX(order_id) FROM OrderInfo WHERE user_id = (SELECT user_id FROM User WHERE user_name = '김현지'));

-- 조리 완료 후 배달 시작
UPDATE OrderInfo 
SET status = '배달중'
WHERE order_id = (SELECT MAX(order_id) FROM OrderInfo WHERE user_id = (SELECT user_id FROM User WHERE user_name = '김현지'));

-- 배달 완료
UPDATE OrderInfo 
SET status = '완료', delivered_at = NOW()
WHERE order_id = (SELECT MAX(order_id) FROM OrderInfo WHERE user_id = (SELECT user_id FROM User WHERE user_name = '김현지'));
```

### [리뷰 작성]

```sql
INSERT INTO StoreReview (
  store_id,
  user_id,
  order_id,
  author_name,
  content,
  photo_url,
  rating,
  created_at
)
VALUES (
  (SELECT store_id FROM Store WHERE name = '가영이네'),
  (SELECT user_id FROM User WHERE user_name = '김현지'),
  195,  -- 예: 실제 주문 번호를 지정 (예: 김현지가 며칠 전에 주문한 주문 ID)
  '김현지',
  '며칠 전에 주문했는데 아이가 정말 잘 먹었어요. 재구매 의사 있어요 😊',
  'review_gayoungine_05.jpg',
  5.0,
  NOW()
);
```

### [가게 찜하기]

```sql
INSERT INTO StoreLike (user_id, store_id) VALUES (1, 1);
```

---

## [조회 기능]

- 가게는 ‘좋아요’를 눌렀지만 주문은 하지 않은 경우
- 각 상점의 평균 주문 금액
- 각 상점의 총 매출 계산
- 가장 인기 있는 가게 상위 5개
- 특정 사용자의 자녀가 알레르기 반응을 이르킬 수 있는 음식
- 특정 음식을 주문한 사용자
- 특정 상점의 주문 횟수 대비 ‘좋아요’ 비율

---

# [BDDB 문제 상황]

## [문제 1. CSV IMPORT]

현재 CSV파일들은 외래키 제약조건 때문에 아래 순서를 고려하지 않으면, IMPORT 되지 않는 문제가 있음.

### **[문제 해결 방법 1 -Import 순서 (외래키 제약 고려한 순서)]**

```sql
1. User — 모든 다른 테이블의 기반이 되는 부모 테이블
2. Child — User를 참조
3. Allergen — 독립 테이블
4. ChildAllergy — Child, Allergen을 참조
5. Store — User를 참조
6. StoreLike — User, Store를 참조
7. StoreReview — User, Store를 참조
8. Food — Store를 참조
9. FoodIngredient — Food, Allergen을 참조
10. OrderInfo — User, Store를 참조
11. OrderItem — OrderInfo, Food를 참조
12. Payment — User를 참조
```

### **[문제 해결 방법 2 Import 시 외래키 제약 무시하는 방법]**

MySQL에서는 일시적으로 외래키 검사를 끌 수 있으며, CSV import 전에 아래 명령을 실행하면 순서 실수를 해도 임시로 통과 됨

```sql
SET FOREIGN_KEY_CHECKS = 0;

-- 여기서 모든 테이블에 대해 LOAD DATA INFILE 또는 INSERT 실행

SET FOREIGN_KEY_CHECKS = 1;
```